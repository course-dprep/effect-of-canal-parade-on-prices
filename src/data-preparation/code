---
title: "Airbnb calendar"
output:
  pdf_document: default
  html_document: default
date: "2022-09-22"
---


#open files

install.packages("R.utils")
library(R.utils)
gunzip("calendar.csv.gz", remove=FALSE)
gunzip("listings (2).csv.gz", remove=FALSE)
gunzip("reviews.csv.gz", remove=FALSE)


#summarize data sets

summary(calendar)
summary(listings_2_)


#count listing id w/o duplicates (calendar & listing_2_)

calendar_unique <- unique(calendar$listing_id)
length(calendar_unique)

listings_unique <- unique(listings_2_$id)
length(listings_unique)


#Drop columns
#Keep columns listings: id, neighbourhood, price, availability
#keep columns calendar: listing_id, date, available, price, adjusted_price

library(dplyr)
calendar_x <- select(calendar, c("listing_id", "price", "available", "adjusted_price", "date"))
listing_x <- select(listings_2_, c("id", "neighbourhood_cleansed", "price", "availability_365"))


#checking data types

is.numeric(listing_x$id)
is.character(listing_x$neighbourhood_cleansed)
is.numeric(listing_x$price)
is.numeric(listing_x$availability_365)

sapply(calendar_x, class)


#Changing data type
#listing_x

price_trimmed = str_remove(listing_x$price, ",")
price_trimmed

listing_x$price = str_remove(listing_x$price,",")
listing_x$price = as.numeric(gsub("\\$", "", listing_x$price))

sum(is.na(listing_x$price))
sum(is.na(listings_2_$price))

as.numeric(listing_x$price)
is.numeric(listing_x$price)


#calendar_x

calendar_x$price = str_remove(calendar_x$price, ",")
calendar_x$adjusted_price = str_remove(calendar_x$adjusted_price,",")

calendar_x$price = as.numeric(gsub("\\$", "", calendar_x$price))
calendar_x$adjusted_price = as.numeric(gsub("\\$", "", calendar_x$adjusted_price))

as.numeric(calendar_x$price)
as.numeric(calendar_x$adjusted_price)

is.numeric(calendar_x$price)
is.numeric(calendar_x$adjusted_price)

sum(is.na(listing_x$price))
sum(is.na(calendar_x$price))
sum(is.na(calendar_x$adjusted_price))


#merge listing_x and calendar_x

new_dataset <- calendar_x %>% left_join(listing_x, by = c("listing_id" = "id"), suffix = c("_calendar", "_listing"))


#remove na's 

new_dataset_1 <- new_dataset %>% drop_na(price_calendar)
sum(is.na(new_dataset_1$price_calendar))

new_dataset_1 %>% drop_na(adjusted_price)
sum(is.na(new_dataset_1$adjusted_price))

#save new file

write.csv(new_dataset_1, "new_dataset_dprep.csv")


